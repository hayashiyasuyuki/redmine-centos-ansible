- name: mysql.cnfの配置
  become: yes
  copy:
    src=my.cnf
    dest={{ my_cnf_path }}

- name: mysql ユーザのパスワード変更
  mysql_user:
    name: "root"
    host: "{{ item }}"
    password: "{{ db_passwd_redmine }}"
  with_items:
    - keis-redmine.prod.local

- name: MySQLの初期設定
  become: yes
  service:
    name=mysqld
    state=restarted
    enabled=yes

- name: セキュリティ設定
  become: yes
  shell:
    mysql_secure_installation

- name: MySQLユーザー作成
  become: yes
  become_user: mysql
  become_method: su
  mysql_user:
    name=mysql
    password={{ db_passwd_redmine }}

- name: MySQL データベース作成
  become: yes
  become_user: mysql
  become_method: su
  mysql_db:
    name=redmine
    encoding='UTF-8'
    lc_collate='ja_JP.UTF-8'
    lc_ctype='ja_JP.UTF-8'
    template='template0'
